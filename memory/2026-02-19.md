# 2026-02-19

## OpenClaw：Windows 主控 + iMac 共存（Control UI + Tailscale Serve）教訓 / SOP

### 問題根因（這次踩坑點）
- Control UI 對「安全內容」有要求：
  - `http://<tailnet-ip>:18789`（非 localhost 的 HTTP）會被擋：`disconnected (1008): control ui requires HTTPS or localhost (secure context)`
- `gateway.bind=tailnet` 時，Gateway 可能**不聽 127.0.0.1**，導致：
  - `http://127.0.0.1:18789` 會 `ERR_CONNECTION_REFUSED`
  - 若 Tailscale Serve 仍 proxy 到 `127.0.0.1:18789`，就會變成 **502 Bad Gateway**
- token 與 pairing 是兩道不同的門：
  - `token missing`：需要提供 gateway token（URL `#token=` 或在 UI settings 貼 token）
  - `pairing required`：需要在 Windows 用 `openclaw devices approve <requestId>` 批准 Control UI 裝置

### 最終穩定解（Windows + iMac 都能開 Web UI）
- 核心原則：**遠端一律走 Tailscale Serve 提供的 HTTPS**，不要用 tailnet IP 的 HTTP。
- 穩定配置：
  - Windows：Tailscale Serve → proxy 到 `http://127.0.0.1:18789`
  - 兩端瀏覽器都用：`https://desktop-6b46las.tail1a4556.ts.net/`

### 固定操作（可重複照做）
1) Windows：確認 Gateway 可被 localhost 存取（必要時）
   - `openclaw config set gateway.bind auto`
   - `openclaw gateway restart`
2) Windows：設定 Tailscale Serve（HTTPS）
   - `tailscale serve reset`
   - `tailscale serve --bg http://127.0.0.1:18789`
   - `tailscale serve status`
3) iMac / Windows：用 HTTPS URL 開 Control UI
   - `https://desktop-6b46las.tail1a4556.ts.net/`
4) 若遇到 token missing：用 `openclaw dashboard --no-open` 取得/複製 token，貼到 URL `#token=` 或 UI settings
5) 若遇到 pairing required：Windows 用 `openclaw devices list` → `openclaw devices approve <requestId>`

### 重要提醒
- 不要在 PowerShell 用 `>>` 來「串指令」，那是輸出重導；要用換行或 `;`。
